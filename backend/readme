
# üíß Monitoramento de N√≠vel de √Ågua

Este projeto tem como objetivo monitorar o n√≠vel de √°gua utilizando um sensor ultrass√¥nico conectado ao Arduino, que envia os dados via Bluetooth para um aplicativo mobile feito em Flutter. Os dados s√£o armazenados em um banco MySQL e podem ser visualizados no app. √â ideal para reservat√≥rios ou caixas d‚Äô√°gua.

## üì± Aplicativo Mobile (Frontend)

- **Framework:** Flutter
- **Bibliotecas:** http, flutter_bluetooth_serial

### Funcionalidades
- Cadastro e login de usu√°rios, recupera√ß√£o de senha
- Conex√£o com Arduino via Bluetooth
- Visualiza√ß√£o do n√≠vel de √°gua
- Hist√≥rico de logs
- Edi√ß√£o de perfil
- Integra√ß√£o com Mysql e Backend

## üß† Backend (Node.js + MySQL)

- **Framework:** Express.js
- **Banco de Dados:** MySQL
- **Seguran√ßa:** Bcrypt para criptografia de senhas
- **Padr√£o:** MVC com separa√ß√£o de camadas (`controllers`, `models`, `routes`)

### Endpoints da API

#### üë§ Usu√°rios

| M√©todo | Rota | Descri√ß√£o |
|--------|------|-----------|
| POST | `/monitoapi/usuarios` | Cadastrar usu√°rio |
| GET | `/monitoapi/usuarios` | Listar todos |
| GET | `/monitoapi/usuarios/:id` | Buscar por ID |
| PUT | `/monitoapi/usuarios/:id` | Atualizar usu√°rio |
| DELETE | `/monitoapi/usuarios/:id` | Deletar usu√°rio |
| POST | `/monitoapi/usuarios/recuperar-senha` | Atualizar senha do usu√°rio |

#### üìù Registros

| M√©todo | Rota | Descri√ß√£o |
|--------|------|-----------|
| GET | `/monitoapi/registros` | Listar registros |
| PUT | `/monitoapi/registros/:id` | Atualizar |
| DELETE | `/monitoapi/registros` | Deletar todos |

#### üîê Autentica√ß√£o

| M√©todo | Rota | Descri√ß√£o |
|--------|------|-----------|
| POST | `/auth` | Login (JSON com login e senha) |

#### üßæ Logs

| M√©todo | Rota | Descri√ß√£o |
|--------|------|-----------|
| GET | `/api/logs` | Visualizar logs de a√ß√µes do sistema |

## ü§ñ Arduino

- **Componentes:**
  - Arduino UNO
  - Sensor Ultrass√¥nico HC-SR04
  - M√≥dulo Bluetooth HC-05
  - Jumpers, protoboard

### Funcionamento
1. O sensor HC-SR04 mede a dist√¢ncia da √°gua at√© o sensor.
2. Os dados s√£o enviados via Bluetooth para o app.
3. O app envia os dados para o backend.
4. O backend grava no MySQL e registra no log (via trigger).
5. Os dados podem ser visualizados no app.

### Esquema de Liga√ß√£o (Resumo)
- HC-SR04: VCC ‚Üí 5V, GND ‚Üí GND, Trig ‚Üí D9, Echo ‚Üí D10
- HC-05: VCC ‚Üí 5V, GND ‚Üí GND, RX ‚Üí TX, TX ‚Üí RX (com divisor de tens√£o)

## ‚öôÔ∏è Como rodar

### Backend
```bash
git clone <repo>
cd backend
npm install
npm run dev
```
- Configure o `.env` com:
  - DB_HOST, DB_USER, DB_PASSWORD, DB_NAME
  - PORT

### Frontend (Flutter)
```bash
cd nivel_de_agua
flutter pub get
flutter run
```


## üóÑ Estrutura do Banco de Dados

### Tabela `usuarios`
- idusuario, usuario, nomeusuario, telefone, email, login, senha

### Tabela `registro`
- idregistro, nivelagua, data_hora

### Tabela `log`
- idlog, tpacao, loginusuario, datahora, idregistro, dsregold, dsregnew, tpacaoregold, tpacaoregold, nomeusuarioold, nomeusuarionew

Triggers cuidam de alimentar a tabela `log` automaticamente com base nas a√ß√µes do usu√°rio.

## ‚úÖ Conclus√£o

Este sistema integra hardware (Arduino), mobile (Flutter) e backend (Node.js + MySQL) para uma solu√ß√£o de monitoramento completa. Pode ser expandido com notifica√ß√µes, alertas de n√≠vel cr√≠tico e automa√ß√µes.

---
